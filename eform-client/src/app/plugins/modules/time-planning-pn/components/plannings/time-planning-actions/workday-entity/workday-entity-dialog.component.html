<!-- src/app/plugins/modules/time-planning-pn/components/plannings/time-planning-actions/workday-entity/workday-entity-dialog.component.html -->
<div mat-dialog-title>{{ data.siteName }} - {{ datePipe.transform(data.date, 'dd.MM.yyyy') }} ({{data.id}})</div><div mat-dialog-content>
  <br>
  <mtx-grid
    [columns]="tableHeaders"
    [data]="shiftData"
    [showPaginator]="false"
    [pageOnFront]="false"
    [rowStriped]="true"
    [showToolbar]="false"
    [showColumnMenuButton]="false">
  </mtx-grid>

  <ng-template #plannedColumnTemplate let-row let-col="colDef">
    <ng-container *ngIf="row['shift'] === '1'">
      <div class="flex-row">
        <mat-form-field>
          <mat-label>{{'Start' | translate}}</mat-label>
          <input
            matInput
            [ngxTimepicker]="plannedPicker"
            [format]="24"
            [(ngModel)]="plannedStartOfShift1"
            readonly
            [max]="plannedEndOfShift1"
            [value]="plannedStartOfShift1"
          >
          <ngx-material-timepicker #plannedPicker
                                   (closed)="calculatePlanHours()"
                                   [format]="24"
                                   [defaultTime]="plannedStartOfShift1"
                                   [minutesGap]="5"></ngx-material-timepicker>
        </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetPlannedTimes(1)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <div class="flex-row">
        <mat-form-field>
          <mat-label>{{'Pause' | translate}}</mat-label>
          <input
            matInput
            [ngxTimepicker]="plannedPause1Picker"
            [disabled]="plannedStartOfShift1 === '00:00' || plannedEndOfShift1 === '00:00'"
            [format]="24"
            [(ngModel)]="plannedBreakOfShift1"
            readonly
            [min]="'00:00'"
            [max]="getMaxDifference(plannedStartOfShift1, plannedEndOfShift1)"
            [value]="plannedBreakOfShift1"
          >
          <ngx-material-timepicker #plannedPause1Picker
                                   (closed)="calculatePlanHours()"
                                   [format]="24"
                                   [defaultTime]="plannedBreakOfShift1"
                                   [minutesGap]="5"></ngx-material-timepicker>
        </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetPlannedTimes(2)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <div class="flex-row">
        <mat-form-field>
          <mat-label>{{'Stop' | translate}}</mat-label>
          <input
            matInput
            [ngxTimepicker]="plannedPicker2"
            [disabled]="plannedStartOfShift1 === '00:00'"
            [format]="24"
            [(ngModel)]="plannedEndOfShift1"
            readonly
            [min]="plannedStartOfShift1"
            [max]="plannedStartOfShift2 === '00:00' ? '23:55' : plannedStartOfShift2"
            [value]="plannedEndOfShift1">
          <ngx-material-timepicker #plannedPicker2
                                   (closed)="calculatePlanHours()"
                                   [format]="24"
                                   [defaultTime]="plannedEndOfShift1"
                                   [minutesGap]="5"></ngx-material-timepicker>
        </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetPlannedTimes(3)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </ng-container>
    <ng-container *ngIf="row['shift'] === '2'">
      <div class="flex-row">
        <mat-form-field>
          <mat-label>{{'Start' | translate}}</mat-label>
          <input
            matInput
            [ngxTimepicker]="plannedPicker3"
            [disabled]="plannedEndOfShift1 === '00:00'"
            readonly
            [format]="24"
            [(ngModel)]="plannedStartOfShift2"
            [min]="plannedEndOfShift1"
            [max]="plannedEndOfShift2 === '00:00' ? '23:55' : plannedEndOfShift2"
            [value]="plannedStartOfShift2">
          <ngx-material-timepicker #plannedPicker3
                                   (closed)="calculatePlanHours()"
                                   [format]="24"
                                   [defaultTime]="plannedStartOfShift2"
                                   [minutesGap]="5"></ngx-material-timepicker>
        </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetPlannedTimes(4)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <div class="flex-row">
        <mat-form-field>
          <mat-label>{{'Pause' | translate}}</mat-label>
          <input
            matInput
            [disabled]="plannedStartOfShift2 === '00:00' || plannedEndOfShift2 === '00:00'"
            [ngxTimepicker]="plannedPause2Picker"
            [format]="24"
            [(ngModel)]="plannedBreakOfShift2"
            readonly
            [min]="'00:00'"
            [max]="getMaxDifference(plannedStartOfShift2, plannedEndOfShift2)"
            [value]="plannedBreakOfShift2"
          >
          <ngx-material-timepicker #plannedPause2Picker
                                   (closed)="calculatePlanHours()"
                                   [format]="24"
                                   [defaultTime]="plannedBreakOfShift2"
                                   [minutesGap]="5"></ngx-material-timepicker>
        </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetPlannedTimes(5)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <div class="flex-row">
        <mat-form-field>
          <mat-label>{{'Stop' | translate}}</mat-label>
          <input
            matInput
            [disabled]="plannedStartOfShift2 === '00:00'"
            readonly
            [ngxTimepicker]="plannedPicker4"
            [format]="24"
            [(ngModel)]="plannedEndOfShift2"
            [min]="plannedStartOfShift2 === '00:00' ? plannedEndOfShift1 : plannedStartOfShift2"
            [value]="plannedEndOfShift2 === '00:00' ? '' : plannedEndOfShift2">
          <ngx-material-timepicker #plannedPicker4
                                   (closed)="calculatePlanHours()"
                                   [format]="24"
                                   [defaultTime]="plannedEndOfShift2 === '00:00' ? '' : plannedEndOfShift2"
                                   [minutesGap]="5"></ngx-material-timepicker>
        </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetPlannedTimes(6)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </ng-container>

  </ng-template>

  <ng-template #actualColumnTemplate let-row let-col="colDef">
    <ng-container *ngIf="row['shift'] === '1'">
      <div class="flex-row">
      <mat-form-field>
        <mat-label>{{'Start' | translate}}</mat-label>
        <input
          matInput
          readonly
          [disabled]="isInTheFuture"
          [ngxTimepicker]="picker"
          [format]="24"
          [(ngModel)]="start1StartedAt"
          [max]="stop1StoppedAt"
          [value]="start1StartedAt"
        >
        <ngx-material-timepicker #picker
                                 (closed)="calculatePlanHours()"
                                 [format]="24"
                                 [defaultTime]="start1StartedAt"
                                 [minutesGap]="5"
        ></ngx-material-timepicker>
      </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetActualTimes(1)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <div class="flex-row">
      <mat-form-field>
        <mat-label>{{'Pause' | translate}}</mat-label>
        <input
          matInput
          [disabled]="isInTheFuture || start1StartedAt === null || stop1StoppedAt === null"
          [ngxTimepicker]="pause1IdPicker"
          [format]="24"
          [(ngModel)]="pause1Id"
          readonly
          [min]="'00:00'"
          [max]="getMaxDifference(start1StartedAt, stop1StoppedAt)"
          [value]="pause1Id"
        >
        <ngx-material-timepicker #pause1IdPicker
                                 (closed)="calculatePlanHours()"
                                 [format]="24"
                                 [defaultTime]="pause1Id"
                                 [minutesGap]="5"></ngx-material-timepicker>
      </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetActualTimes(2)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <div class="flex-row">
      <mat-form-field>
        <mat-label>{{'Stop' | translate}}</mat-label>
        <input
          matInput
          readonly
          [disabled]="isInTheFuture || start1StartedAt === null"
          [ngxTimepicker]="picker2"
          [format]="24"
          [(ngModel)]="stop1StoppedAt"
          [min]="start1StartedAt"
          [max]="start2StartedAt"
          [value]="stop1StoppedAt">
        <ngx-material-timepicker #picker2
                                 (closed)="calculatePlanHours()"
                                 [format]="24"
                                 [defaultTime]="stop1StoppedAt"
                                 [minutesGap]="5"></ngx-material-timepicker>
      </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetActualTimes(3)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </ng-container>
    <ng-container *ngIf="row['shift'] === '2'">
      <div class="flex-row">
      <mat-form-field>
        <mat-label>{{'Start' | translate}}</mat-label>
        <input
          matInput
          readonly
          [disabled]="isInTheFuture || stop1StoppedAt === null"
          [ngxTimepicker]="picker3"
          [format]="24"
          [(ngModel)]="start2StartedAt"
          [min]="stop1StoppedAt"
          [max]="stop2StoppedAt"
          [value]="start2StartedAt">
        <ngx-material-timepicker #picker3
                                 (closed)="calculatePlanHours()"
                                 [format]="24"
                                 [defaultTime]="start2StartedAt"
                                 [minutesGap]="5"></ngx-material-timepicker>
      </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetActualTimes(4)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <div class="flex-row">
      <mat-form-field>
        <mat-label>{{'Pause' | translate}}</mat-label>
        <input
          matInput
          [disabled]="isInTheFuture || start2StartedAt === null || stop2StoppedAt === null"
          [ngxTimepicker]="pause2IdPicker"
          [format]="24"
          [(ngModel)]="pause2Id"
          readonly
          [min]="'00:00'"
          [max]="getMaxDifference(start2StartedAt, stop2StoppedAt)"
          [value]="pause2Id"
        >
        <ngx-material-timepicker #pause2IdPicker
                                 (closed)="calculatePlanHours()"
                                 [format]="24"
                                 [defaultTime]="pause2Id"
                                 [minutesGap]="5"></ngx-material-timepicker>
      </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetActualTimes(5)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <div class="flex-row">
      <mat-form-field>
        <mat-label>{{'Stop' | translate}}</mat-label>
        <input
          matInput
          readonly
          [disabled]="isInTheFuture || start2StartedAt === null"
          [ngxTimepicker]="picker4"
          [format]="24"
          [(ngModel)]="stop2StoppedAt"
          [min]="start2StartedAt"
          [value]="stop2StoppedAt">
        <ngx-material-timepicker #picker4
                                 (closed)="calculatePlanHours()"
                                 [format]="24"
                                 [defaultTime]="stop2StoppedAt"
                                 [minutesGap]="5"></ngx-material-timepicker>
      </mat-form-field>
        <button
          mat-icon-button
          color="warn"
          (click)="resetActualTimes(6)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </ng-container>
  </ng-template>

  <!--  <p><strong>{{ 'Plan text' | translate }}:</strong> {{ data.planText }}</p>-->
  <br>
  <mat-form-field class="pr-2">
    <mat-label>{{ 'Flex balance at start of day' | translate }}</mat-label>
    <input
      type="text"
      matInput
      id="flexToDate"
      name="flexToDate"
      readonly="readonly"
      disabled
      [value]="data.sumFlexStart.toFixed(2)"
    >
  </mat-form-field>
  <br><mat-form-field class="pr-2">
  <mat-label>{{ 'Plan hours' | translate }}</mat-label>
  <input
    type="number"
    matInput
    id="planHours"
    name="planHours"
    [disabled]="isInTheFuture || data.message === null"
    [(ngModel)]="data.planHours"
  >
</mat-form-field>
  <br>
  <mat-form-field class="pr-2">
    <mat-label>{{ 'NettoHours' | translate }}</mat-label>
    <input
      type="text"
      matInput
      id="nettoHours"
      name="nettoHours"
      readonly="readonly"
      disabled
      [value]="convertHoursToTime(data.actualHours)"
    >
  </mat-form-field>
  <br>
  <mat-form-field class="pr-2">
    <mat-label>{{ 'Flex' | translate }}</mat-label>
    <input
      type="text"
      matInput
      id="todaysFlex"
      name="todaysFlex"
      readonly="readonly"
      disabled
      [value]="convertHoursToTime(todaysFlex)"
    >
  </mat-form-field>
  <br>
  <mat-form-field class="pr-2">
    <mat-label>{{ 'PaidOutFlex' | translate }}</mat-label>
    <input
      type="number"
      matInput
      id="paidOutFlex"
      name="paidOutFlex"
      (change)="calculatePlanHours()"
      [(ngModel)]="data.paidOutFlex"
    >
  </mat-form-field>
  <br>
  <mat-form-field class="pr-2">
    <mat-label>{{ 'SumFlex' | translate }}</mat-label>
    <input
      type="text"
      matInput
      id="flexIncludingToday"
      name="flexIncludingToday"
      readonly="readonly"
      disabled
      [value]="data.sumFlexEnd.toFixed(2)"
    >
  </mat-form-field>
  <br>
  <br>
  <p *ngIf="data.workerComment"><strong>{{ 'CommentWorker' | translate }}:</strong> {{ data.workerComment }}</p>
  <ng-container *ngFor="let key of enumKeys">
    <ng-container *ngIf="key !== 'Blank' && key !== 'Care'">
      <mat-checkbox [(ngModel)]="data[key]" (change)="onCheckboxChange(TimePlanningMessagesEnum[key])">
        {{ key | translate }}
      </mat-checkbox>
    </ng-container>
  </ng-container>
  <br>
  <br>
  <mat-form-field class="pr-2">
    <mat-label>{{ 'CommentOffice' | translate }}</mat-label>
    <input
      type="text"
      matInput
      id="CommentOffice"
      name="CommentOffice"
      [(ngModel)]="data.commentOffice"
    >
  </mat-form-field>
  <br>
  <!-- Add more fields as needed -->
</div>
<div mat-dialog-actions class="d-flex flex-row justify-content-end">
  <button mat-raised-button mat-dialog-close
          (click)="onCancel()">
    {{'Cancel' | translate}}
  </button>
  <button
    mat-raised-button
    color="accent"
    (click)="onUpdateWorkDayEntity()"
    [mat-dialog-close]="data">
    {{'Save' | translate}}
  </button>
</div>
